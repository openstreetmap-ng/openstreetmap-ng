// Style the "Map Layers" sidebar picker
.map-sidebar.layers {
  // Make each layer clickable and overlay a label on top of it
  .layer {
    @extend .rounded-2;

    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: box-shadow 0.08s ease-out;

    // Button wrapper inside list items
    .layer-button {
      display: block;
      width: 100%;
      padding: 0;
      font: inherit;
      color: inherit;
      text-align: inherit;
      background: none;
      border: 0;
    }

    // Add some margin between each layer
    &:not(:last-child) {
      margin-bottom: 0.875rem;
    }

    .label {
      @extend .text-body;

      position: absolute;
      top: 0;
      left: 0;
      z-index: 850;
      padding: 0.15rem 0.5rem;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      background: rgba($body-bg, 0.8);
      border-bottom-right-radius: $border-radius-sm;
      backdrop-filter: blur(0.5rem);

      img {
        @extend .me-1-5;

        position: relative;
        top: -0.09em;
        height: 1em;
      }
    }

    .vector {
      @extend .ms-1;

      position: relative;
      top: -0.3em;
      font-size: 0.7em;
      font-weight: 800;
      color: tint-color($primary, 20%);
      text-transform: uppercase;
    }

    .map-container {
      height: 3.5rem;
      overflow: hidden;

      // Fix small "white pop" visual glitch in Dark Mode on Chrome
      border-top-left-radius: calc($border-radius + 2px);

      // Render at a larger viewport and scale down so minimaps show more area
      > .maplibregl-map {
        width: 200%;
        height: 200%;
        transform: scale(0.5);
        transform-origin: top left;
      }

      > img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
    }

    // Change border color depending on the state
    &.active {
      box-shadow:
        0 0 0 1px var(--bs-body-bg),
        0 0 0 0.25rem $primary;
    }

    &:hover {
      box-shadow:
        0 0 0 0 transparent,
        0 0 0 0.25rem rgba($primary, 0.4);

      &.active {
        box-shadow:
          0 0 0 0 transparent,
          0 0 0 0.25rem shade-color($primary, 20%);
      }
    }
  }

  // Reset default button styles for interactive tiles
  button.layer {
    display: block;
    width: 100%;
    padding: 0;
    font: inherit;
    color: inherit;
    text-align: inherit;
    background: none;
    border: 0;
  }

  .layer-order {
    ul {
      padding: 0.875rem 1em 0;
      margin: -0.875rem -1em 0;
      overflow-y: hidden;

      // Fix WebKit overlap issue
      // https://github.com/openstreetmap-ng/openstreetmap-ng/issues/168#issuecomment-3029499779
      list-style-type: none;
    }

    &.collapsed {
      ul {
        max-height: 16rem;
        mask-image: linear-gradient(to bottom, rgb(0 0 0 / 100%) 80%, rgb(0 0 0 / 0%));
      }

      .show-less {
        display: none;
      }
    }

    &:not(.collapsed) {
      .show-more {
        display: none;
      }
    }
  }

  .layer-settings {
    @extend .bg-body-tertiary;
    @extend .rounded-2;

    .layer {
      margin-bottom: 0;
    }

    .layer-settings-inner {
      padding: 0.125rem 0.375rem;
      font-size: 0.875em;
    }
  }

  .form-check-label .spinner-border {
    --bs-spinner-width: 0.875em;
    --bs-spinner-height: 0.875em;
    --bs-spinner-border-width: 0.2em;
  }

  .bi-question-circle {
    cursor: help;
  }
}

@include color-mode(dark) {
  .map-sidebar.layers {
    .layer {
      .label {
        background: rgba($body-bg-dark, 0.8);
      }

      .vector {
        color: tint-color($primary, 50%);
      }
    }
  }
}
