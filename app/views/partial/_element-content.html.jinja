<div class="social-entry">
    <p class="header text-muted d-flex justify-content-between">
        <span>
            {# User #}
            {% if not changeset.user %}
            {{ t('browse.anonymous') }}
            {% else %}
            <a href="/user/{{ changeset.user.display_name }}">
                <img class="avatar" src="{{ user_avatar_url(changeset.user) }}" alt="{{ t('alt.profile_picture') }}"
                    loading="lazy">
                {{- changeset.user.display_name -}}
            </a>
            {% endif %}

            {# Action #}
            {% if element.visible %}
            {{ t('action.edited') }}
            {% else %}
            {{ t('action.deleted') }}
            {% endif %}

            {# Timestamp #}
            <time datetime="{{ element.created_at.isoformat() }}" data-style="long"></time>
        </span>

        {# Deleted Icon #}
        {% if not element.visible %}
        <span class="badge text-bg-secondary">
            <i class="bi bi-trash-fill"></i>
        </span>
        {% endif %}
    </p>

    <div class="body">
        {# Changeset #}
        <p class="position-relative mb-1">
            {{ t('browse.in_changeset') }}
            #<a href="/changeset/{{ element.changeset_id }}">
                {{- element.changeset_id -}}
            </a>
        </p>
        {# Comment #}
        <div class="fst-italic">{{ comment_html | safe }}</div>
    </div>

</div>

{# Location #}
{% if place %}
<p class="location-container mb-2">
    {{ t('diary_entries.form.location') }}:
    <button class="btn btn-link stretched-link" data-lon="{{ element.point.x }}"
        data-lat="{{ element.point.y }}">{{ place }}</button>
</p>
{% endif %}

{# Tags #}
{% if tags or (user is not none and next_version is none and element.visible) %}
<div class="tags-section">
    {# Tags header with edit button #}
    <div class="d-flex justify-content-between align-items-center mb-1">
        <h4 class="mb-0">{{ t('browse.tags') }}</h4>
        {% if user is not none and next_version is none and element.visible %}
        <button class="btn btn-link p-0 edit-tags-btn" type="button">
            {{ t('action.edit_tags') }}
        </button>
        {% endif %}
    </div>

    {# Tags view (default) #}
    {% if tags %}
    <div class="tags tags-view"
         data-tags="{{ tags | tojson | forceescape }}"
         {% if tags_old %} data-tags-old="{{ tags_old | tojson | forceescape }}" {% endif %}>
        <table class="table table-sm">
            <tbody dir="auto">
                {%- for key, value in tags | dictsort -%}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ value }}</td>
                </tr>
                {%- endfor -%}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="tags tags-view" data-tags="{}">
        <p class="text-muted mb-0">{{ t('state.none') }}</p>
    </div>
    {% endif %}

    {# Tags edit form (hidden by default) #}
    {% if user is not none and next_version is none and element.visible %}
    <form class="tags-edit-form d-none" method="POST" action="/api/0.7/element/{{ element.typed_id }}/tags">
        <div class="mb-2">
            <textarea class="form-control tags-textarea" name="tags" rows="8"
                      placeholder="{{ t('browse.tags_format_hint') }}"></textarea>
        </div>
        <div class="mb-2">
            <input class="form-control" type="text" name="comment"
                   placeholder="{{ t('changeset.comment') }}" required>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-secondary discard-tags-btn" type="button">
                {{ t('action.discard') }}
            </button>
            <button class="btn btn-primary" type="submit">
                {{ t('action.save') }}
            </button>
        </div>
    </form>
    {% endif %}
</div>
{% endif %}

{% set table %}
{% if compact %}
<details>
    <div class="elements-list mb-2">
        <table>
            <tbody></tbody>
        </table>
    </div>
    <nav aria-label="{{ t('alt.elements_page_navigation') }}">
        <ul class="pagination pagination-sm pagination-2ch justify-content-end mb-0"></ul>
    </nav>
</details>
{% else %}
<div class="elements-list mb-2">
    <table>
        <tbody></tbody>
    </table>
</div>
<nav aria-label="{{ t('alt.elements_page_navigation') }}">
    <ul class="pagination pagination-sm pagination-2ch justify-content-end mb-0"></ul>
</nav>
{% endif %}
{% endset %}

{# Parents #}
{% if show_parents %}
<div class="parents mt-4 mb-1">
    <h4 class="title"></h4>
    {{ table }}
</div>
{% endif %}

{# Members #}
{% if show_elements %}
<div class="elements mt-4 mb-1">
    <h4 class="title"></h4>
    {{ table }}
</div>
{% endif %}
