<div class="sidebar-content">
    <div class="section">

        <div class="row g-1 mb-1">
            <div class="col">
                <h2>
                    <span class="sidebar-title" data-params="{{ params }}">
                        {{ t('note.title') }}: {{ note.id }}
                    </span>
                    <span class="status-badge badge" data-status="{{ status }}">
                        {% if status == 'open' %}
                        {{ t('state.unresolved') }}
                        {% elif status == 'closed' %}
                        {{ t('state.resolved') }}
                        {% elif status == 'hidden' %}
                        <i class="bi bi-eye-slash-fill"></i>
                        {{ t('state.hidden') }}
                        {% endif %}
                    </span>
                </h2>
            </div>
            <div class="col-auto">
                <button class="sidebar-close-btn btn-close" aria-label="{{ t('javascripts.close') }}"></button>
            </div>
        </div>

        <div class="social-entry">
            <p class="header text-muted d-flex justify-content-between">
                <span>
                    {% if not header.user %}
                    <img class="avatar" src="{{ get_avatar_url('anonymous_note', note.id) }}"
                        alt="{{ t('alt.profile_picture') }}">
                    {{- t('browse.anonymous') -}}
                    {% else %}
                    <a href="/user/{{ header.user.display_name }}" rel="author">
                        <img class="avatar" src="{{ user_avatar_url(header.user) }}"
                            alt="{{ t('alt.profile_picture') }}">
                        {{- header.user.display_name -}}
                    </a>
                    {% endif %}
                    {{ t('browse.created') | lower }}
                    <time datetime="{{ header.created_at.isoformat() }}" data-style="long"></time>
                </span>
            </p>
            {% if header.body %}
            <div class="body pre">{{ header.body_rich | safe }}</div>
            {% endif %}
            {% if not header.user %}
            <div class="alert alert-warning mb-2" role="alert">
                {{ t('notes.show.anonymous_warning') }}
            </div>
            {% endif %}
        </div>
        <p class="location-container mb-0">
            {{ t('diary_entries.form.location') }}:
            <button class="btn btn-link stretched-link">{{ place }}</button>
        </p>

        {% if user is not none %}
        <div class="text-end mt-1 me-1">
            {% if not header.user %}
            {# Anonymous note reporting #}
            <button class="btn btn-link btn-sm text-muted p-0" data-report-type="anonymous_note"
                data-report-type-id="{{ note.id }}" data-report-action="generic">
                <i class="bi bi-flag small me-1-5"></i>
                {{- t('report.report_object', object=nt('note.count', 1)) -}}
            </button>
            {% elif header.user_id != user.id %}
            {# User note reporting #}
            <button class="btn btn-link btn-sm text-muted p-0" data-report-type="user"
                data-report-type-id="{{ header.user_id }}" data-report-action="user_note"
                data-report-action-id="{{ note.id }}">
                <i class="bi bi-flag small me-1-5"></i>
                {{- t('report.report_object', object=nt('note.count', 1)) -}}
            </button>
            {% endif %}
        </div>
        {% endif %}

        <div class="mb-4"></div>

        <div class="row g-1 mb-1">
            <div class="col">
                <h4>{{ t('browse.changeset.discussion') }}</h4>
            </div>
            {% if user is not none %}
            {% if is_subscribed %}
            <form class="col-auto subscription-form" method="POST"
                action="/api/web/user-subscription/note/{{ note.id }}/unsubscribe">
                <button class="btn btn-sm btn-light border" type="submit">
                    <i class="bi bi-bookmark-check me-1"></i>
                    {{ t('javascripts.changesets.show.unsubscribe') }}
                </button>
            </form>
            {% else %}
            <form class="col-auto subscription-form" method="POST"
                action="/api/web/user-subscription/note/{{ note.id }}/subscribe">
                <button class="btn btn-sm btn-light border" type="submit">
                    {{ t('javascripts.changesets.show.subscribe') }}
                </button>
            </form>
            {% endif %}
            {% endif %}
        </div>

        {% if note_comments_num_items %}
        <div class="note-comments-pagination">
            <ul class="list-unstyled mb-2"></ul>
            <nav aria-label="{{ t('alt.comments_page_navigation') }}">
                <ul class="pagination pagination-sm justify-content-end mb-2"
                    data-action="/api/web/note/{{ note.id }}/comments" data-pages="{{ note_comments_num_pages }}"
                    data-num-items="{{ note_comments_num_items }}">
                </ul>
            </nav>
        </div>
        {% endif %}

        {% if disappear_days is not none %}
        <p class="text-center fst-italic mx-4">
            {{ t(
                'notes.show.disappear_date_html',
                disappear_in=nt('user_blocks.helper.block_duration.days', count=disappear_days)
            ) | safe }}
        </p>
        {% endif %}

        {% if user is not none %}
        <form class="comment-form" method="POST" action="/api/web/note/{{ note.id }}/comment">
            <input type="hidden" name="event" autocomplete="off" required>
            {% if status == 'open' %}
            <textarea class="form-control mb-3" name="text" rows="5"></textarea>
            <div class="row g-1">
                <div class="col">
                    {% if user_is_moderator(user) %}
                    <button class="btn btn-light border" type="submit" data-event="hidden">
                        {{ t('notes.show.hide') }}
                    </button>
                    {% endif %}
                </div>
                <div class="col-auto">
                    <button class="close-btn btn btn-primary" type="submit" data-event="closed">
                        {{ t('notes.show.resolve') }}
                    </button>
                    <button class="comment-close-btn btn btn-primary" type="submit" data-event="closed">
                        {{ t('notes.show.comment_and_resolve') }}
                    </button>
                    <button class="comment-btn btn btn-primary ms-1" type="submit" data-event="commented">
                        {{ t('action.comment') }}
                    </button>
                </div>
            </div>
            {% elif status == 'closed' %}
            <div class="row g-1 mt-3">
                <div class="col">
                    {% if user_is_moderator(user) %}
                    <button class="btn btn-light border" type="submit" data-event="hidden">
                        {{ t('notes.show.hide') }}
                    </button>
                    {% endif %}
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" type="submit" data-event="reopened">
                        {{ t('notes.show.reactivate') }}
                    </button>
                </div>
            </div>
            {% elif status == 'hidden' %}
            <div class="mt-3">
                <button class="btn btn-light border" type="submit" data-event="reopened">
                    {{ t('action.unhide') }}
                </button>
            </div>
            {% endif %}
        </form>
        {% else %}
        <div class="text-center">
            <button class="btn btn-link" type="button" data-bs-toggle="modal" data-bs-target="#loginModal">
                {{ t('browse.changeset.join_discussion') }}
            </button>
        </div>
        {% endif %}

    </div>
    {% if user is not none and user.id != header.user_id %}
    <div class="section small">
        {% set _link %}
        {% if not header.user %}
        <button class="btn btn-sm btn-link p-0" data-report-type="anonymous_note" data-report-type-id="{{ note.id }}"
            data-report-action="generic">
            {{- t('notes.show.report') -}}
        </button>
        {%- else %}
        <button class="btn btn-sm btn-link p-0" data-report-type="user" data-report-type-id="{{ header.user_id }}"
            data-report-action="user_note" data-report-action-id="{{ note.id }}">
            {{- t('notes.show.report') -}}
        </button>
        {%- endif %}
        {%- endset %}
        {{ t('notes.show.report_link_html', link=_link) | safe }}

        {% if status == 'open' %}
        {{ t('notes.show.other_problems_resolve') }}
        {% elif status == 'closed' %}
        {{ t('notes.show.other_problems_resolved') }}
        {% endif %}
    </div>
    {% endif %}
</div>
